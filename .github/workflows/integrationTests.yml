name: Integration Tests

on:
  schedule:
  - cron: 0 2 * * 1-5
  workflow_dispatch:

jobs:
  test-Integration-previous:
    runs-on: macos-10.15
    strategy:
        matrix:
            run-config:
            - { scheme: 'IntegrationTests (iOS)', destination: 'platform=iOS Simulator,name=iPhone 8' }
            - { scheme: 'IntegrationTests (tvOS)', destination: 'platform=tvOS Simulator,name=Apple TV' }
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: 11.4.1
    - name: Integration tests
      run: xcodebuild -scheme '${{ matrix.run-config['scheme'] }}' -destination '${{ matrix.run-config['destination'] }}' test
    - uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: 12.0.1
    - name: Integration tests
      run: xcodebuild -scheme '${{ matrix.run-config['scheme'] }}' -destination '${{ matrix.run-config['destination'] }}' test
  test-Integration-latest:
    runs-on: macos-11
    strategy:
        matrix:
            run-config:
            - { scheme: 'IntegrationTests (iOS)', destination: 'platform=iOS Simulator,name=iPhone 8' }
            - { scheme: 'IntegrationTests (tvOS)', destination: 'platform=tvOS Simulator,name=Apple TV' }
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: 11.7
    - name: Integration tests
      run: xcodebuild -scheme '${{ matrix.run-config['scheme'] }}' -destination '${{ matrix.run-config['destination'] }}' test
    - uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: 12.5
    - name: Integration tests
      run: xcodebuild -scheme '${{ matrix.run-config['scheme'] }}' -destination '${{ matrix.run-config['destination'] }}' test
  test-xcode-12-5:
    runs-on: macos-11
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: 12.5
    - name: Unit tests
      run: make tests
  test-xcode-12-4:
    runs-on: macos-11
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: 12.4
    - name: Unit tests
      run: make tests
  test-xcode-11-7:
    runs-on: macos-11
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: 11.7
    - name: Unit tests
      run: make tests

